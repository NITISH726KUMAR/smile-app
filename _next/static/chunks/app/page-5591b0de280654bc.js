(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4530:()=>{},8108:()=>{},12884:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>k});var s=a(95155),r=a(12115),l=a(35317),n=a(90858),c=a(23915),i=a(16203);let o=(0,c.Dk)().length?(0,c.Sx)():(0,c.Wp)({apiKey:"your_api_key",authDomain:"your_auth_domain",projectId:"your_project_id",storageBucket:"your_storage_bucket",messagingSenderId:"your_messaging_sender_id",appId:"your_app_id"}),d=(0,l.aU)(o),m=(0,n.c7)(o);(0,i.xI)(o);var u=a(53429),h=a.n(u),x=a(80093),g=a(53937);a(68484);let p=e=>{let{videoRef:t,onSmileScoreChange:a}=e,[s,l]=(0,r.useState)(!0),n=(0,r.useRef)(void 0),c=(0,r.useRef)(null),i=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e=async()=>{try{l(!0),await g.Gc4();try{await g.jh6("webgl"),console.log("Using WebGL backend")}catch(e){console.warn("WebGL backend failed, falling back to CPU:",e),await g.jh6("cpu"),console.log("Using CPU backend")}l(!1)}catch(e){console.error("Error initializing TensorFlow.js:",e),l(!1)}};return c.current||(c.current=document.createElement("canvas"),c.current.width=360,c.current.height=360,i.current=c.current.getContext("2d",{willReadFrequently:!0,alpha:!1})),e(),()=>{g.rm6(),n.current&&cancelAnimationFrame(n.current)}},[]);let o=e=>g.DZQ(()=>{try{let t=g.TaL.fromPixels(e,1),a=t.shape[0],s=Math.floor(.6*a),r=Math.floor(.25*a),l=t.slice([s,0],[r,-1]),n=l.mean().dataSync()[0],c=g.Clk(l).variance.dataSync()[0],i=Math.min(c/1e3,1);return Math.min(Math.max(Math.round((n/255*.4+.6*i)*100),0),100)}catch(e){return console.error("Error in smile detection:",e),0}}),d=()=>{if(!t.current||!c.current||!i.current||s){n.current=requestAnimationFrame(d);return}try{let e;let s=t.current,r=c.current,l=i.current;if(s.readyState!==s.HAVE_ENOUGH_DATA){n.current=requestAnimationFrame(d);return}l.imageSmoothingEnabled=!0,l.imageSmoothingQuality="medium",l.drawImage(s,0,0,r.width,r.height);try{e=l.getImageData(0,0,r.width,r.height);let t=o(e);a(t)}catch(e){console.error("Error getting image data:",e)}}catch(e){console.error("Error in detect smile:",e)}n.current=requestAnimationFrame(d)};return(0,r.useEffect)(()=>(s||d(),()=>{n.current&&cancelAnimationFrame(n.current)}),[s]),null},f=e=>{var t;let{onCapture:a}=e,l=(0,r.useRef)(null),[n,c]=(0,r.useState)(0),[i,o]=(0,r.useState)(!1),[d,m]=(0,r.useState)(!1),[u,g]=(0,r.useState)(null),f=(0,r.useCallback)(()=>{var e;if(n<50){o(!0),setTimeout(()=>o(!1),2e3);return}let t=null===(e=l.current)||void 0===e?void 0:e.getScreenshot();t&&a(t,n)},[a,n]);return((0,r.useEffect)(()=>{let e=async()=>{try{l.current&&l.current.video&&(l.current.video.onloadedmetadata=()=>{m(!0)})}catch(e){console.error("Error accessing webcam:",e),g("Could not access camera. Please make sure you have granted camera permissions.")}};d||u||e()},[d,u]),u)?(0,s.jsx)("div",{className:"bg-red-50 p-4 rounded-lg",children:(0,s.jsx)("p",{className:"text-red-600",children:u})}):(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("div",{className:"absolute top-0 left-0 right-0 bg-gradient-to-b from-black/70 to-transparent p-4 z-10",children:[(0,s.jsx)("h2",{className:"text-center text-white text-2xl font-bold mb-1",children:"Smile to Make Money"}),(0,s.jsx)("p",{className:"text-center text-white/90 text-sm",children:"Share your best smile and earn rewards!"})]}),(0,s.jsx)(h(),{audio:!1,ref:l,screenshotFormat:"image/jpeg",className:"w-full rounded-lg",videoConstraints:{width:720,height:720,facingMode:"user",frameRate:{ideal:30}}}),(0,s.jsx)("div",{className:"absolute top-24 left-1/2 transform -translate-x-1/2 bg-white/90 px-4 py-2 rounded-full shadow-lg",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("span",{className:"text-lg font-semibold",children:"Smile Rating:"}),(0,s.jsx)("span",{className:"text-lg ".concat(n>=80?"text-green-500":n>=50?"text-blue-500":"text-yellow-500"),children:n>=80?"\uD83D\uDE04 5/5":n>=70?"\uD83D\uDE0A 4/5":n>=60?"\uD83D\uDE42 3/5":n>=50?"\uD83D\uDE10 2/5":"\uD83D\uDE15 1/5"})]})}),i&&(0,s.jsx)("div",{className:"absolute top-40 left-1/2 transform -translate-x-1/2 bg-red-500 text-white px-4 py-2 rounded-lg shadow-lg animate-bounce",children:"Show us a bigger smile! Need at least 2/5 to capture"}),(0,s.jsx)("button",{onClick:f,className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 rounded-full p-4 shadow-lg ".concat(n>=50?"bg-green-500 hover:bg-green-600":"bg-white hover:bg-gray-100"),children:(0,s.jsx)(x.A,{className:"h-8 w-8 ".concat(n>=50?"text-white":"text-blue-500")})}),d&&(null===(t=l.current)||void 0===t?void 0:t.video)&&(0,s.jsx)(p,{videoRef:{current:l.current.video},onSmileScoreChange:e=>{c(e)}})]})};var b=a(66766),j=a(82940),w=a.n(j),v=a(99949),N=a(1664),y=a(38984);let S=e=>{let{username:t,userImage:a,image:r,caption:l,timestamp:n,likes:c,isLiked:i=!1,onLike:o}=e;return(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-sm mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center p-4",children:[(0,s.jsx)("div",{className:"h-10 w-10 relative rounded-full overflow-hidden",children:(0,s.jsx)(b.default,{src:a,alt:t,fill:!0,className:"object-cover"})}),(0,s.jsx)("p",{className:"font-semibold ml-3",children:t})]}),(0,s.jsx)("div",{className:"relative aspect-square",children:(0,s.jsx)(b.default,{src:r,alt:"Post",fill:!0,className:"object-cover"})}),(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)("button",{onClick:o,children:i?(0,s.jsx)(y.A,{className:"h-7 w-7 text-red-500"}):(0,s.jsx)(v.A,{className:"h-7 w-7"})}),(0,s.jsx)(N.A,{className:"h-7 w-7"})]}),(0,s.jsxs)("p",{className:"font-bold mt-2",children:[c," likes"]}),(0,s.jsxs)("p",{className:"mt-1",children:[(0,s.jsx)("span",{className:"font-bold mr-2",children:t}),l]}),(0,s.jsx)("p",{className:"text-gray-400 text-sm mt-1",children:w()(n).fromNow()})]})]})};function k(){let[e,t]=(0,r.useState)(!1),[a,c]=(0,r.useState)([]),[i,o]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=(0,l.aQ)((0,l.P)((0,l.rJ)(d,"posts"),(0,l.My)("timestamp","desc")),e=>{c(e.docs.map(e=>({id:e.id,...e.data()})))});return()=>e()},[]);let u=async(e,a)=>{o(!0);try{let s=new Image;s.src=e,await new Promise(e=>s.onload=e);let r=document.createElement("canvas"),c=r.getContext("2d"),i=s.width,o=s.height;i>o?i>1080&&(o*=1080/i,i=1080):o>1080&&(i*=1080/o,o=1080),r.width=i,r.height=o,null==c||c.drawImage(s,0,0,i,o);let u=r.toDataURL("image/jpeg",.8),h=(0,n.KR)(m,"posts/".concat(Date.now()));await (0,n.ls)(h,u,"data_url");let x=await (0,n.qk)(h);await (0,l.gS)((0,l.rJ)(d,"posts"),{username:"User",userImage:"https://placekitten.com/100/100",image:x,caption:"Sharing my smile! \uD83D\uDE0A (Smile Score: ".concat(a,"%)"),timestamp:(0,l.O5)(),likes:0,smileScore:a}),t(!1)}catch(e){console.error("Error uploading post:",e)}o(!1)};return(0,s.jsxs)("main",{className:"max-w-xl mx-auto p-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold",children:"Smile App"}),(0,s.jsx)("button",{onClick:()=>t(!e),className:"bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600",children:e?"Close Camera":"Share Smile"})]}),e&&(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)(f,{onCapture:u})}),i&&(0,s.jsx)("div",{className:"text-center py-4",children:(0,s.jsxs)("div",{className:"animate-pulse",children:[(0,s.jsx)("p",{className:"text-lg font-semibold",children:"Processing your smile..."}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"This will only take a moment"})]})}),(0,s.jsx)("div",{className:"space-y-6",children:a.map(e=>(0,s.jsx)(S,{username:e.username,userImage:e.userImage,image:e.image,caption:e.caption,timestamp:e.timestamp,likes:e.likes},e.id))})]})}},18590:()=>{},41234:()=>{},80551:()=>{},80972:(e,t,a)=>{Promise.resolve().then(a.bind(a,12884))},85817:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[586,690,272,660,56,87,251,674,992,888,896,441,684,358],()=>t(80972)),_N_E=e.O()}]);